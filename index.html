<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ElXora - AI Lua Scripter for Roblox</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    :root {
      --bg: #0a0a0f;
      --sidebar-bg: #111118;
      --card-bg: #1a1a24;
      --purple: #a855f7;
      --purple-dark: #7e22ce;
      --blue: #3b82f6;
      --text: #e0e0ff;
      --text-muted: #a1a1aa;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background:var(--bg);
      color:var(--text);
      font-family:'Inter',sans-serif;
      height:100vh;
      display:flex;
      overflow:hidden;
      font-size:clamp(0.9rem, 2.5vw, 1rem);
    }
    .access-screen {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.95);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:1000;
      transition:opacity 0.4s;
    }
    .access-screen.hidden {
      opacity:0;
      pointer-events:none;
    }
    .access-card {
      background:var(--card-bg);
      border:2px solid var(--purple);
      border-radius:1.5rem;
      padding:clamp(2rem, 5vw, 3.5rem) clamp(1.5rem, 4vw, 2.5rem);
      max-width:clamp(320px, 80vw, 440px);
      width:90%;
      text-align:center;
      box-shadow:0 0 3rem rgba(168,85,247,0.35);
    }
    .access-card h1.glow {
      font-family:'Orbitron',sans-serif;
      font-size:clamp(2.5rem, 8vw, 4rem);
      margin-bottom:1.5rem;
      text-shadow:0 0 1rem var(--purple), 0 0 2rem var(--purple-dark);
    }
    .error { color:#ff6b6b; margin-top:1rem; font-size:1rem; }
    .sidebar {
      width:clamp(240px, 30vw, 280px);
      background:var(--sidebar-bg);
      border-right:1px solid #2a1a4a;
      padding:1.5rem;
      overflow-y:auto;
      flex-shrink:0;
    }
    .main {
      flex:1;
      display:flex;
      flex-direction:column;
    }
    .chat-header {
      padding:1rem 1.5rem;
      background:#111118;
      border-bottom:1px solid #2a1a4a;
      font-size:1.3rem;
      color:#c084fc;
      font-weight:500;
    }
    .chat-messages {
      flex:1;
      padding:1.5rem;
      overflow-y:auto;
      display:flex;
      flex-direction:column;
      gap:1.25rem;
    }
    .message {
      max-width:86%;
      padding:0.9rem 1.3rem;
      border-radius:1.2rem;
      display:flex;
      align-items:flex-start;
      gap:0.8rem;
      font-size:clamp(0.95rem, 3vw, 1.05rem);
    }
    .ai-message {
      align-self:flex-start;
      background:#2a1a4a;
      border-radius:1.2rem 1.2rem 1.2rem 0.3rem;
    }
    .user-message {
      align-self:flex-end;
      background:#3b82f6;
      border-radius:1.2rem 1.2rem 0.3rem 1.2rem;
      flex-direction:row-reverse;
    }
    .avatar {
      width:clamp(32px, 5vw, 38px);
      height:clamp(32px, 5vw, 38px);
      border-radius:50%;
      background:#a855f7;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:bold;
      font-size:1rem;
      flex-shrink:0;
    }
    .message-content {
      white-space:pre-wrap;
      flex:1;
    }
    .input-bar {
      padding:1rem 1.5rem;
      background:#111118;
      border-top:1px solid #2a1a4a;
      display:flex;
      align-items:center;
      gap:0.8rem;
    }
    textarea {
      flex:1;
      min-height:52px;
      max-height:160px;
      padding:0.9rem 1.2rem;
      background:#1a1a24;
      border:1px solid #4a2a6e;
      border-radius:1rem;
      color:white;
      font-size:1rem;
      resize:none;
      outline:none;
    }
    .input-icon {
      width:44px;
      height:44px;
      background:#2a1a4a;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:1.3rem;
      transition:background 0.2s;
    }
    .input-icon:hover { background:#4a2a6e; }
    .send-btn {
      padding:0 1.8rem;
      background:#a855f7;
      border:none;
      border-radius:1rem;
      color:white;
      font-weight:bold;
      cursor:pointer;
      font-size:1rem;
    }
    .blinking-cursor {
      color:#c084fc;
      animation:blink 0.8s infinite;
    }
    @keyframes blink { 50% { opacity:0; } }
    .hidden { display:none !important; }
  </style>
</head>
<body>

  <!-- Login Overlay -->
  <div class="access-screen" id="accessScreen">
    <div class="access-card">
      <h1 class="glow">ElXora</h1>
      <p>Login with Google to continue</p>

      <div id="g_id_onload"
           data-client_id="1091074303503-gsgnp618bh4vd2n9d0it9acs4ctujhc4.apps.googleusercontent.com"
           data-callback="handleGoogleLogin"
           data-auto_prompt="false">
      </div>
      <div class="g_id_signin" data-type="standard" data-size="large" data-theme="filled_black" data-text="signin_with" data-shape="rectangular" data-logo_alignment="left"></div>

      <p id="errorMsg" class="error"></p>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar" style="display:none;">
    <div class="sidebar-header">ElXora</div>

    <div class="user-profile" id="userProfile" style="display:none;">
      <img id="userAvatar" class="user-avatar" src="" alt="Profile" />
      <div class="user-info">
        <div id="userName" class="user-name"></div>
        <div id="userEmail" class="user-email"></div>
      </div>
    </div>

    <div class="new-chat" id="newChatBtn">+ New Chat</div>
    <div class="chat-list" id="chatList"></div>
  </div>

  <!-- Main Chat -->
  <div class="main" id="mainContent" style="display:none;">
    <div class="chat-header">Chat with ElXora</div>
    <div class="chat-messages" id="chatContainer"></div>

    <div class="input-bar">
      <div class="input-icon" title="Attach file/image">ðŸ“Ž</div>
      <div class="input-icon" title="Voice mode">ðŸŽ¤</div>
      <textarea id="prompt" placeholder="Ask me anything Roblox..." rows="1"></textarea>
      <button id="generateBtn" class="send-btn">Send</button>
    </div>
  </div>

  <script>
    // Google Login Handler
    function handleGoogleLogin(response) {
      const jwt = response.credential;
      const payload = JSON.parse(atob(jwt.split('.')[1]));

      console.log("Google User:", payload);

      localStorage.setItem("google_user", JSON.stringify(payload));

      // Hide login overlay
      const loginScreen = document.getElementById('accessScreen');
      loginScreen.classList.add('hidden');

      // Show main app + sidebar
      document.getElementById('mainContent').style.display = 'flex';
      document.getElementById('sidebar').style.display = 'block';

      // Show user profile
      document.getElementById('userProfile').style.display = 'flex';
      document.getElementById('userAvatar').src = payload.picture || 'https://via.placeholder.com/48';
      document.getElementById('userName').textContent = payload.name || 'User';
      document.getElementById('userEmail').textContent = payload.email || 'No email';

      console.log("Login successful - app should be visible now");

      // Optional: small delay to ensure DOM update
      setTimeout(() => {
        loginScreen.style.display = 'none';
      }, 300);
    }

    // Auto-login check
    const savedUser = localStorage.getItem("google_user");
    if (savedUser) {
      const payload = JSON.parse(savedUser);
      document.getElementById('accessScreen').classList.add('hidden');
      document.getElementById('mainContent').style.display = 'flex';
      document.getElementById('sidebar').style.display = 'block';
      document.getElementById('userProfile').style.display = 'flex';
      document.getElementById('userAvatar').src = payload.picture || 'https://via.placeholder.com/48';
      document.getElementById('userName').textContent = payload.name || 'User';
      document.getElementById('userEmail').textContent = payload.email || 'No email';
      console.log("Auto-login successful");
    }

    // Rest of your chat logic (add your full Groq + chat history code here)
    // For example:
    document.getElementById('generateBtn').addEventListener('click', () => {
      alert('AI chat would start here - add your Groq fetch code');
    });
  </script>
</body>
</html>
